/*!
DeftJS 5.0.0

Copyright (c) 2012-2013 [DeftJS Framework Contributors](http://deftjs.org)
Open source under the [MIT License](http://en.wikipedia.org/wiki/MIT_License).
*/

Ext.define("Deft.util.Function",{alternateClassName:["Deft.Function"],statics:{memoize:function(d,c,a){var b;b={};return function(f){var e;e=Deft.isFunction(a)?a.apply(c,arguments):f;if(!(e in b)){b[e]=d.apply(c,arguments)}return b[e]}},nextTick:Ext.emptyFn,isFunction:Ext.emptyFn,spread:function(b,a){return function(c){if(!Ext.isArray(c)){Ext.Error.raise({msg:"Error spreading passed Array over target function arguments: passed a non-Array."})}return b.apply(a,c)}}}},function(){if(typeof setImmediate!=="undefined"&&setImmediate!==null){this.nextTick=function(b,a,c){if((a!=null)||(c!=null)){b=Ext.Function.bind(b,a,c)}setImmediate(b)}}else{this.nextTick=function(b,a,c){if((a!=null)||(c!=null)){b=Ext.Function.bind(b,a,c)}setTimeout(b,0)}}if(typeof document!=="undefined"&&typeof document.getElementsByTagName("body")==="function"){this.isFunction=function(a){return !!a&&toString.call(a)==="[object Function]"}}else{this.isFunction=function(a){return !!a&&typeof a==="function"}}Deft.isFunction=this.isFunction});Ext.define("Deft.log.Logger",{alternateClassName:["Deft.Logger"],requires:["Deft.util.Function"],singleton:true,log:function(b,a){if(a==null){a="info"}},verbose:function(a){this.log(a,"verbose")},info:function(a){this.log(a,"info")},deprecate:function(a){this.log(a,"deprecate")},warn:function(a){this.log(a,"warn")},error:function(a){this.log(a,"error")}},function(){return this.log=function(b,a){if(a==null){a="info"}if(a==="verbose"){a="info"}if(a==="deprecate"){a="warn"}Ext.Logger.log(b,a)}});Ext.define("Deft.ioc.DependencyProvider",{requires:["Deft.log.Logger"],config:{identifier:null,className:null,parameters:null,fn:null,value:void 0,singleton:true,eager:false},constructor:function(b){var a;this.initConfig(b);if((b.value!=null)&&b.value.constructor===Object){this.setValue(b.value)}if(this.getEager()){if(this.getValue()!=null){Ext.Error.raise({msg:"Error while configuring '"+(this.getIdentifier())+"': a 'value' cannot be created eagerly."})}if(!this.getSingleton()){Ext.Error.raise({msg:"Error while configuring '"+(this.getIdentifier())+"': only singletons can be created eagerly."})}}if(this.getClassName()!=null){a=Ext.ClassManager.get(this.getClassName());if(a==null){Deft.Logger.warn("Synchronously loading '"+(this.getClassName())+"'; consider adding Ext.require('"+(this.getClassName())+"') above Ext.onReady.");Ext.syncRequire(this.getClassName());a=Ext.ClassManager.get(this.getClassName())}if(a==null){Ext.Error.raise({msg:"Error while configuring rule for '"+(this.getIdentifier())+"': unrecognized class name or alias: '"+(this.getClassName())+"'"})}}if(!this.getSingleton()){if(this.getClassName()!=null){if(Ext.ClassManager.get(this.getClassName()).singleton){Ext.Error.raise({msg:"Error while configuring rule for '"+(this.getIdentifier())+"': singleton classes cannot be configured for injection as a prototype. Consider removing 'singleton: true' from the class definition."})}}if(this.getValue()!=null){Ext.Error.raise({msg:"Error while configuring '"+(this.getIdentifier())+"': a 'value' can only be configured as a singleton."})}}else{if((this.getClassName()!=null)&&(this.getParameters()!=null)){if(Ext.ClassManager.get(this.getClassName()).singleton){Ext.Error.raise({msg:"Error while configuring rule for '"+(this.getIdentifier())+"': parameters cannot be applied to singleton classes. Consider removing 'singleton: true' from the class definition."})}}}return this},resolve:function(d,e){var c,a,b;Deft.Logger.log("Resolving '"+(this.getIdentifier())+"'.");if(this.getValue()!==void 0){return this.getValue()}a=null;if(this.getFn()!=null){Deft.Logger.log("Executing factory function.");if(e){c=[d].concat(Ext.toArray(e))}else{c=[d]}a=this.getFn().apply(Deft.Injector,c)}else{if(this.getClassName()!=null){if(Ext.ClassManager.get(this.getClassName()).singleton){Deft.Logger.log("Using existing singleton instance of '"+(this.getClassName())+"'.");a=Ext.ClassManager.get(this.getClassName())}else{Deft.Logger.log("Creating instance of '"+(this.getClassName())+"'.");b=this.getParameters()!=null?[this.getClassName()].concat(this.getParameters()):[this.getClassName()];a=Ext.create.apply(this,b)}}else{Ext.Error.raise({msg:"Error while configuring rule for '"+(this.getIdentifier())+"': no 'value', 'fn', or 'className' was specified."})}}if(this.getSingleton()){this.setValue(a)}return a}});Ext.define("Deft.ioc.Injector",{alternateClassName:["Deft.Injector"],requires:["Ext.Component","Deft.log.Logger","Deft.ioc.DependencyProvider","Deft.util.Function"],singleton:true,constructor:function(){this.providers={};this.injectionStack=[];return this},configure:function(b){var a;Deft.Logger.log("Configuring the injector.");a={};Ext.Object.each(b,function(d,c){var e;Deft.Logger.log("Configuring dependency provider for '"+d+"'.");if(Ext.isString(c)){e=Ext.create("Deft.ioc.DependencyProvider",{identifier:d,className:c})}else{e=Ext.create("Deft.ioc.DependencyProvider",Ext.apply({identifier:d},c))}this.providers[d]=e;a[d]=e},this);Ext.Object.each(a,function(c,d){if(d.getEager()){Deft.Logger.log("Eagerly creating '"+(d.getIdentifier())+"'.");d.resolve()}},this)},reset:function(){Deft.Logger.log("Resetting the injector.");this.providers={}},canResolve:function(a){var b;b=this.providers[a];return b!=null},resolve:function(a,b,d){var c;c=this.providers[a];if(c!=null){return c.resolve(b,d)}else{Ext.Error.raise({msg:"Error while resolving value to inject: no dependency provider found for '"+a+"'."})}},inject:function(e,f,k,j){var h,a,b,c,d,i,g;if(j==null){j=true}i=Ext.getClassName(f);if(Ext.Array.contains(this.injectionStack,i)){d=this.injectionStack.join(" -> ");this.injectionStack=[];Ext.Error.raise({msg:"Error resolving dependencies for '"+i+"'. A circular dependency exists in its injections: "+d+" -> *"+i+"*"});return null}this.injectionStack.push(i);h={};if(Ext.isString(e)){e=[e]}Ext.Object.each(e,function(o,p){var n,l,m;m=Ext.isArray(e)?p:o;n=p;l=this.resolve(n,f,k);if(m in f.config){Deft.Logger.log("Injecting '"+n+"' into '"+i+"."+m+"' config.");h[m]=l}else{Deft.Logger.log("Injecting '"+n+"' into '"+i+"."+m+"' property.");f[m]=l}},this);this.injectionStack=[];if(j){for(a in h){g=h[a];c="set"+Ext.String.capitalize(a);f[c].call(f,g)}}else{if(Deft.isFunction(f.initConfig)){b=f.initConfig;f.initConfig=function(m){var l;l=b.call(this,Ext.Object.merge({},m||{},h));return l}}}return f}},function(){Ext.define("Deft.InjectableComponent",{override:"Ext.Component",constructor:function(a){a=Ext.Object.merge({},a||{},this.injectConfig||{});delete this.injectConfig;return this.callParent([a])}})});Ext.define("Deft.core.Class",{alternateClassName:["Deft.Class"],statics:{extendsClass:function(c,b){var a;try{if(Ext.getClassName(c)===b){return true}if(c!=null?c.superclass:void 0){if(Ext.getClassName(c.superclass)===b){return true}else{return Deft.Class.extendsClass(Ext.getClass(c.superclass),b)}}else{return false}}catch(d){a=d;return false}}}});Ext.define("Deft.event.LiveEventListener",{alternateClassName:["Deft.LiveEventListener"],requires:["Ext.ComponentQuery"],constructor:function(c){var b,d,e,a;Ext.apply(this,c);this.components=[];d=Ext.ComponentQuery.query(this.selector,this.container);for(e=0,a=d.length;e<a;e++){b=d[e];this.components.push(b);b.on(this.eventName,this.fn,this.scope,this.options)}},destroy:function(){var b,d,a,c;c=this.components;for(d=0,a=c.length;d<a;d++){b=c[d];b.un(this.eventName,this.fn,this.scope)}this.components=null},register:function(a){if(this.matches(a)){this.components.push(a);a.on(this.eventName,this.fn,this.scope,this.options)}},unregister:function(b){var a;a=Ext.Array.indexOf(this.components,b);if(a!==-1){b.un(this.eventName,this.fn,this.scope);Ext.Array.erase(this.components,a,1)}},matches:function(a){if(this.selector===null&&this.container===a){return true}if(this.container===null&&Ext.Array.contains(Ext.ComponentQuery.query(this.selector),a)){return true}if(a.isDescendantOf(this.container)&&Ext.Array.contains(this.container.query(this.selector),a)){return true}return false}});Ext.define("Deft.event.LiveEventBus",{alternateClassName:["Deft.LiveEventBus"],requires:["Ext.Component","Ext.ComponentManager","Deft.event.LiveEventListener"],singleton:true,constructor:function(){this.listeners=[]},destroy:function(){var d,c,a,b;b=this.listeners;for(c=0,a=b.length;c<a;c++){d=b[c];d.destroy()}this.listeners=null},addListener:function(b,a,c,f,e,d){var g;g=Ext.create("Deft.event.LiveEventListener",{container:b,selector:a,eventName:c,fn:f,scope:e,options:d});this.listeners.push(g)},removeListener:function(b,a,c,e,d){var f;f=this.findListener(b,a,c,e,d);if(f!=null){Ext.Array.remove(this.listeners,f);f.destroy()}},on:function(b,a,c,f,e,d){return this.addListener(b,a,c,f,e,d)},un:function(b,a,c,e,d){return this.removeListener(b,a,c,e,d)},findListener:function(a,c,f,g,i){var b,d,h,e;e=this.listeners;for(d=0,h=e.length;d<h;d++){b=e[d];if(b.container===a&&b.selector===c&&b.eventName===f&&b.fn===g&&b.scope===i){return b}}return null},register:function(a){a.on("added",this.onComponentAdded,this);a.on("removed",this.onComponentRemoved,this)},unregister:function(a){a.un("added",this.onComponentAdded,this);a.un("removed",this.onComponentRemoved,this)},onComponentAdded:function(c,b,d){var g,f,a,e;e=this.listeners;for(f=0,a=e.length;f<a;f++){g=e[f];g.register(c)}},onComponentRemoved:function(c,b,d){var g,f,a,e;e=this.listeners;for(f=0,a=e.length;f<a;f++){g=e[f];g.unregister(c)}}},function(){Ext.Function.interceptAfter(Ext.ComponentManager,"register",function(a){Deft.event.LiveEventBus.register(a)});Ext.Function.interceptAfter(Ext.ComponentManager,"unregister",function(a){Deft.event.LiveEventBus.unregister(a)})});Ext.define("Deft.mixin.Injectable",{extend:"Ext.Mixin",requires:["Deft.core.Class","Deft.ioc.Injector","Deft.log.Logger"],mixinConfig:{before:{constructor:"onCreate"}},isInjectable:true,mixinId:"injectable",onCreate:function(){var a;a=function(d){var h,e,b,g,f,c;if(!d){return{};b=a(d.superclass)}else{b={}}e=d.inject||{};if(Ext.isString(e)){e=[e]}if(Ext.isArray(e)){g={};for(f=0,c=e.length;f<c;f++){h=e[f];g[h]=h}e=g}return Ext.applyIf(e,a(d.superclass))};this.inject=a(this);if(!this.$injected){Deft.Injector.inject(this.inject,this,arguments,false);return this.$injected=true}}});Ext.define("Deft.util.DeftMixinUtils",{statics:{mergeSuperclassProperty:function(f,d,c,b){var a,e;if(c==null){c=Ext.merge}if(b==null){b=null}e=false;a=false;if(b==null){b={};a=true}if(((f!=null?f.superclass:void 0)!=null)){b=this.mergeSuperclassProperty(f.superclass,d,c,b)}if(((f!=null?f[d]:void 0)!=null)){b=c(b,f[d],Ext.getClassName(f));e=true}if(e&&a){f[d]=Ext.clone(b)}return b},parentConstructorForVersion:function(){return"callParent"}}});Ext.define("Deft.mixin.Observer",{requires:["Deft.log.Logger","Deft.util.DeftMixinUtils"],onClassMixedIn:function(a){a.override({constructor:Deft.mixin.Observer.createMixinInterceptor()});a.onExtended(function(c,b){c.override({constructor:Deft.mixin.Observer.createMixinInterceptor()});return true})},createObservers:function(){var a,c,b;this.removeObservers();this.registeredObservers={};b=this.observe;for(c in b){a=b[c];this.addObserver(c,a)}},addObserver:function(c,b){var a;a=Ext.create("Deft.mvc.Observer",{host:this,target:c,events:b});this.registeredObservers[c]=a},removeObservers:function(){var a,c,b;b=this.registeredObservers;for(c in b){a=b[c];a.destroy();delete this.registeredObservers[c]}},statics:{MIXIN_COMPLETED_KEY:"$observing",PROPERTY_NAME:"observe",createMixinInterceptor:function(){return function(b){var c,a;if(b==null){b={}}c=Deft.mixin.Observer.MIXIN_COMPLETED_KEY;a=Deft.mixin.Observer.PROPERTY_NAME;if(this[a]==null){this[a]={}}if(!this[c]&&Ext.Object.getSize(this[a])>0){Deft.util.DeftMixinUtils.mergeSuperclassProperty(this,a,Deft.mixin.Observer.propertyMergeHandler);Deft.mixin.Observer.afterMixinProcessed(this);this[Deft.util.DeftMixinUtils.parentConstructorForVersion()](arguments);return this}return this[Deft.util.DeftMixinUtils.parentConstructorForVersion()](arguments)}},propertyMergeHandler:function(q,i){var p,c,m,g,a,o,e,n,j,f,l,k,b,h,d;if(!Ext.isObject(q)){k={}}else{k=Ext.clone(q)}if(!Ext.isObject(i)){a={}}else{a=Ext.clone(i)}e=["buffer","single","delay","element","target","destroyable"];Deft.mixin.Observer.convertConfigArray(k,e);Deft.mixin.Observer.convertConfigArray(a,e);for(o in a){c=a[o];for(p in c){m=c[p];if(Ext.isString(m)){a[o][p]=m.replace(" ","").split(",")}if(!(k!=null?k[o]:void 0)){k[o]={}}if(!(k!=null?(h=k[o])!=null?h[p]:void 0:void 0)){k[o][p]=a[o][p];delete a[o][p]}}}for(b in k){j=k[b];for(n in j){f=j[n];if(Ext.isString(f)){k[b][n]=f.split(",")}if(a!=null?(d=a[b])!=null?d[n]:void 0:void 0){g=a[b][n];l=k[b][n];k[b][n]=Ext.Array.unique(Ext.Array.insert(l,0,g))}}}return k},convertConfigArray:function(j,g){var m,i,c,l,b,d,h,f,k,a,e;e=[];for(l in j){c=j[l];if(Ext.isArray(c)){i={};for(h=0,k=c.length;h<k;h++){d=c[h];if(Ext.Object.getSize(d)===1){Ext.apply(i,d)}else{m={};if((d!=null?d.fn:void 0)!=null){m.fn=d.fn}if((d!=null?d.scope:void 0)!=null){m.scope=d.scope}for(f=0,a=g.length;f<a;f++){b=g[f];if((d!=null?d[b]:void 0)!=null){m[b]=d[b]}}i[d.event]=[m]}}e.push(j[l]=i)}else{e.push(void 0)}}return e},afterMixinProcessed:function(a){a[Deft.mixin.Observer.MIXIN_COMPLETED_KEY]=true}}});Ext.define("Deft.mvc.Application",{alternateClassName:["Deft.Application"],initialized:false,constructor:function(a){if(a==null){a={}}this.initConfig(a);Ext.onReady(function(){this.init();this.initialized=true},this);return this},init:function(){}});Ext.define("Deft.mvc.ComponentSelectorListener",{requires:["Deft.event.LiveEventBus"],constructor:function(c){var b,e,a,d;Ext.apply(this,c);if(this.componentSelector.live){Deft.LiveEventBus.addListener(this.componentSelector.view,this.componentSelector.selector,this.eventName,this.fn,this.scope,this.options)}else{d=this.componentSelector.components;for(e=0,a=d.length;e<a;e++){b=d[e];b.on(this.eventName,this.fn,this.scope,this.options)}}return this},destroy:function(){var b,d,a,c;if(this.componentSelector.live){Deft.LiveEventBus.removeListener(this.componentSelector.view,this.componentSelector.selector,this.eventName,this.fn,this.scope)}else{c=this.componentSelector.components;for(d=0,a=c.length;d<a;d++){b=c[d];b.un(this.eventName,this.fn,this.scope)}}}});Ext.define("Deft.mvc.ComponentSelector",{requires:["Ext.ComponentQuery","Deft.log.Logger","Deft.mvc.ComponentSelectorListener","Deft.util.Function"],constructor:function(c){var a,e,g,b,d,f;Ext.apply(this,c);if(!this.live){this.components=this.selector!=null?Ext.ComponentQuery.query(this.selector,this.view):[this.view]}this.selectorListeners=[];if(Ext.isObject(this.listeners)){f=this.listeners;for(a in f){g=f[a];e=g;d=this.scope;b=null;if(Ext.isObject(g)){b=Ext.apply({},g);if(b.fn!=null){e=b.fn;delete b.fn}if(b.scope!=null){d=b.scope;delete b.scope}}if(Ext.isString(e)&&Deft.isFunction(d[e])){e=d[e]}if(!Deft.isFunction(e)){Ext.Error.raise({msg:"Error adding '"+a+"' listener: the specified handler '"+e+"' is not a Function or does not exist."})}this.addListener(a,e,d,b)}}return this},destroy:function(){var d,c,a,b;b=this.selectorListeners;for(c=0,a=b.length;c<a;c++){d=b[c];d.destroy()}this.selectorListeners=[]},addListener:function(a,d,c,b){var e;if(this.findListener(a,d,c)!=null){Ext.Error.raise({msg:"Error adding '"+a+"' listener: an existing listener for the specified function was already registered for '"+this.selector+"."})}Deft.Logger.log("Adding '"+a+"' listener to '"+this.selector+"'.");e=Ext.create("Deft.mvc.ComponentSelectorListener",{componentSelector:this,eventName:a,fn:d,scope:c,options:b});this.selectorListeners.push(e)},removeListener:function(a,c,b){var d;d=this.findListener(a,c,b);if(d!=null){Deft.Logger.log("Removing '"+a+"' listener from '"+this.selector+"'.");d.destroy();Ext.Array.remove(this.selectorListeners,d)}},findListener:function(b,d,c){var g,f,a,e;e=this.selectorListeners;for(f=0,a=e.length;f<a;f++){g=e[f];if(g.eventName===b&&g.fn===d&&g.scope===c){return g}}return null}});Ext.define("Deft.mvc.Observer",{requires:["Deft.core.Class","Ext.util.Observable","Deft.util.Function"],statics:{mergeObserve:function(b,l){var d,q,m,r,g,k,o,i,n,p,e,f,a,j,h,c;if(!Ext.isObject(b)){a={}}else{a=Ext.clone(b)}if(!Ext.isObject(l)){g={}}else{g=Ext.clone(l)}i=["buffer","single","delay","element","target","destroyable"];o=function(A){var D,z,u,C,t,v,y,x,B,s,w;w=[];for(C in A){u=A[C];if(Ext.isArray(u)){z={};for(y=0,B=u.length;y<B;y++){v=u[y];if(Ext.Object.getSize(v)===1){Ext.apply(z,v)}else{D={};if((v!=null?v.fn:void 0)!=null){D.fn=v.fn}if((v!=null?v.scope:void 0)!=null){D.scope=v.scope}for(x=0,s=i.length;x<s;x++){t=i[x];if((v!=null?v[t]:void 0)!=null){D[t]=v[t]}}z[v.event]=[D]}}w.push(A[C]=z)}else{w.push(void 0)}}return w};o(a);o(g);for(k in g){q=g[k];for(d in q){m=q[d];if(Ext.isString(m)){g[k][d]=m.replace(" ","").split(",")}if(!(a!=null?a[k]:void 0)){a[k]={}}if(!(a!=null?(h=a[k])!=null?h[d]:void 0:void 0)){a[k][d]=g[k][d];delete g[k][d]}}}for(j in a){p=a[j];for(n in p){e=p[n];if(Ext.isString(e)){a[j][n]=e.split(",")}if(g!=null?(c=g[j])!=null?c[n]:void 0:void 0){r=g[j][n];f=a[j][n];a[j][n]=Ext.Array.unique(Ext.Array.insert(f,0,r))}}}return a}},constructor:function(a){var c,k,j,f,i,l,g,h,d,b,e;this.listeners=[];i=a!=null?a.host:void 0;d=a!=null?a.target:void 0;k=a!=null?a.events:void 0;if(i&&d&&(this.isPropertyChain(d)||this.isTargetObservable(i,d))){for(c in k){f=k[c];if(Ext.isString(f)){f=f.replace(" ","").split(",")}for(b=0,e=f.length;b<e;b++){j=f[b];h=i;l=null;if(Ext.isObject(j)){l=Ext.clone(j);if(l!=null?l.event:void 0){c=this.extract(l,"event")}if(l!=null?l.fn:void 0){j=this.extract(l,"fn")}if(l!=null?l.scope:void 0){h=this.extract(l,"scope")}}g=this.locateReferences(i,d,j);if(g){g.target.on(c,g.handler,h,l);this.listeners.push({targetName:d,target:g.target,event:c,handler:g.handler,scope:h});Deft.Logger.log("Created observer on '"+d+"' for event '"+c+"'.")}else{Deft.Logger.warn("Could not create observer on '"+d+"' for event '"+c+"'.")}}}}else{Deft.Logger.warn("Could not create observers on '"+d+"' because '"+d+"' is not an Ext.util.Observable")}return this},isTargetObservable:function(b,e){var a,d,c;a=this.locateTarget(b,e);if(a==null){return false}if((a.isObservable!=null)||(a.isUtilObservable!=null)||a.mixinId==="observable"||(((c=a.mixins)!=null?c.observable:void 0)!=null)){return true}else{d=Ext.ClassManager.getClass(a);return Deft.Class.extendsClass(d,"Ext.util.Observable")||Deft.Class.extendsClass(d,"Ext.mixin.Observable")}},locateTarget:function(b,c){var a;if(Deft.isFunction(b["get"+Ext.String.capitalize(c)])){a=b["get"+Ext.String.capitalize(c)].call(b);return a}else{if((b!=null?b["_"+c]:void 0)!=null){a=b[c];return a}else{if((b!=null?b[c]:void 0)!=null){a=b[c];return a}else{return null}}}},isPropertyChain:function(a){return Ext.isString(a)&&a.indexOf(".")>-1},locateReferences:function(c,d,a){var b,e;b=c;if(this.isPropertyChain(d)){e=this.parsePropertyChain(c,d);if(!e){return null}c=e.host;d=e.target}if(Deft.isFunction(a)){return{target:this.locateTarget(c,d),handler:a}}else{if(Deft.isFunction(b[a])){return{target:this.locateTarget(c,d),handler:b[a]}}else{return null}}},parsePropertyChain:function(a,b){var c;if(Ext.isString(b)){c=b.split(".")}else{if(Ext.isArray(b)){c=b}else{return null}}if(c.length>1&&(this.locateTarget(a,c[0])!=null)){return this.parsePropertyChain(this.locateTarget(a,c[0]),c.slice(1))}else{if(this.isTargetObservable(a,c[0])){return{host:a,target:c[0]}}else{return null}}},extract:function(a,b){var c;c=a[b];delete a[b];return c},destroy:function(){var d,c,a,b;b=this.listeners;for(c=0,a=b.length;c<a;c++){d=b[c];Deft.Logger.log("Removing observer on '"+d.targetName+"' for event '"+d.event+"'.");d.target.un(d.event,d.handler,d.scope)}this.listeners=[]}});Ext.define("Deft.mvc.ViewController",{extend:"Ext.app.ViewController",alternateClassName:["Deft.ViewController"],mixins:["Deft.mixin.Injectable","Deft.mixin.Observer"],requires:["Deft.core.Class","Deft.log.Logger","Deft.mvc.ComponentSelector","Deft.mixin.Injectable","Deft.mixin.Observer","Deft.mvc.Observer","Deft.util.DeftMixinUtils"],config:{companionInstances:null},constructor:function(a){if(a==null){a={}}if(Ext.isObject(a.companions)){this.companions=Ext.merge(this.companions,a.companions);delete a.companions}this.callParent(arguments);this.createObservers();return this},createCompanions:function(){var c,b,d,a;this.companionInstances={};d=this.companions;a=[];for(c in d){b=d[c];a.push(this.addCompanion(c,b))}return a},destroyCompanions:function(){var c,a,d,b;d=this.companionInstances;b=[];for(c in d){a=d[c];b.push(this.removeCompanion(c))}return b},addCompanion:function(f,d){var c,b,a,e,h;if((this.companionInstances[f]!=null)){Deft.Logger.warn("The specified companion alias '"+f+"' already exists.");return}a=false;if(Deft.mvc.ViewController.companionCreationStack.length===0){a=true}try{if(!Ext.Array.contains(Deft.mvc.ViewController.companionCreationStack,Ext.getClassName(this))){Deft.mvc.ViewController.companionCreationStack.push(Ext.getClassName(this))}else{Deft.mvc.ViewController.companionCreationStack.push(Ext.getClassName(this));b=Deft.mvc.ViewController.companionCreationStack[0];h=Deft.mvc.ViewController.companionCreationStack.join(" -> ");Deft.mvc.ViewController.companionCreationStack=[];Ext.Error.raise({msg:"Error creating companions for '"+b+"'. A circular dependency exists in its companions: "+h})}e=Ext.create(d);e.setView(this.getView());this.companionInstances[f]=e;if(a){return Deft.mvc.ViewController.companionCreationStack=[]}}catch(g){c=g;Deft.Logger.warn("Error initializing associated view controller: an error occurred while creating an instance of the specified controller: '"+d+"'.");Deft.mvc.ViewController.companionCreationStack=[];throw c}},removeCompanion:function(b){var a,c;if(this.companionInstances[b]==null){Deft.Logger.warn("The specified companion alias '"+b+"' cannot be removed because the alias does not exist.")}try{if((c=this.companionInstances[b])!=null){c.destroy()}return delete this.companionInstances[b]}catch(d){a=d;Deft.Logger.warn("Error destroying associated view controller: an error occurred while destroying the associated controller with the alias '"+b+"'.");throw a}},getCompanion:function(a){return this.companionInstances[a]},destroy:function(){Ext.log("destroy");this.callParent(arguments);this.removeObservers();this.destroyCompanions();return true},onViewBeforeDestroy:function(){var a;a=this.getView();if(this.destroy()){a.un("beforedestroy",this.onViewBeforeDestroy,this);return true}return false},getViewComponent:function(a){var b;if(a!=null){b=Ext.ComponentQuery.query(a,this.getView());if(b.length===0){return null}else{if(b.length===1){return b[0]}else{return b}}}else{return this.getView()}},onClassExtended:function(b,a){b.override({constructor:Deft.mvc.ViewController.mergeSubclassInterceptor()});return true},privates:{setView:function(a){var c,b;this.callParent(arguments);if((Ext.getVersion("extjs")!=null)){Ext.log("adding beforedestroy");this.getView().on("beforedestroy",this.onViewBeforeDestroy,this)}else{b=this;c=this.getView().destroy;this.getView().destroy=function(){if(b.destroy()){c.call(this)}}}this.createCompanions()}},statics:{companionCreationStack:[],PREPROCESSING_COMPLETED_KEY:"$viewcontroller_processed",mergeSubclassInterceptor:function(){return function(a){var b;if(a==null){a={}}b="companions";if(this[b]==null){this[b]={}}if(!this[Deft.mvc.ViewController.PREPROCESSING_COMPLETED_KEY]){if(Ext.Object.getSize(this[b])>0){Deft.util.DeftMixinUtils.mergeSuperclassProperty(this,b,Deft.mvc.ViewController.companionMergeHandler)}this[Deft.mvc.ViewController.PREPROCESSING_COMPLETED_KEY]=true}this[Deft.util.DeftMixinUtils.parentConstructorForVersion()](arguments);return this}},companionMergeHandler:function(b,a){return Ext.merge(Ext.clone(b),Ext.clone(a))}}});Ext.define("Deft.promise.Consequence",{alternateClassName:["Deft.Consequence"],requires:["Deft.util.Function"],promise:null,resolver:null,onFulfilled:null,onRejected:null,onProgress:null,constructor:function(c,a,b){this.onFulfilled=c;this.onRejected=a;this.onProgress=b;this.resolver=Ext.create("Deft.promise.Resolver");this.promise=this.resolver.promise;return this},trigger:function(b,a){switch(b){case"fulfill":this.propagate(a,this.onFulfilled,this.resolver,this.resolver.resolve);break;case"reject":this.propagate(a,this.onRejected,this.resolver,this.resolver.reject)}},update:function(a){if(Deft.isFunction(this.onProgress)){a=this.onProgress(a)}this.resolver.update(a)},propagate:function(a,d,c,b){if(Deft.isFunction(d)){this.schedule(function(){var e;try{c.resolve(d(a))}catch(f){e=f;c.reject(e)}})}else{b.call(this.resolver,a)}},schedule:Ext.emptyFn},function(){var a,b,c;c=typeof setImmediate!=="undefined"&&setImmediate!==null?setImmediate:function(d){return setTimeout(d,0)};a=(function(){function d(){var g,f,e;e=new Array(10000);f=0;g=function(){var h;h=0;while(h<f){e[h]();e[h]=null;h++}f=0};this.schedule=function(h){e[f++]=h;if(f===1){c(g)}}}return d})();b=new a();this.prototype.schedule=function(f,e,d){b.schedule(f,e,d)}});Ext.define("Deft.promise.Resolver",{alternateClassName:["Deft.Resolver"],requires:["Deft.promise.Consequence"],promise:null,consequences:[],completed:false,completionAction:null,completionValue:null,constructor:function(){this.promise=Ext.create("Deft.promise.Promise",this);this.consequences=[];this.completed=false;this.completionAction=null;this.completionValue=null;return this},then:function(d,a,c){var b;b=Ext.create("Deft.promise.Consequence",d,a,c);if(this.completed){b.trigger(this.completionAction,this.completionValue)}else{this.consequences.push(b)}return b.promise},resolve:function(e){var c,a,b,d;if(this.completed){return}try{if(e===this.promise){throw new TypeError("A Promise cannot be resolved with itself.")}if((Ext.isObject(e)||Deft.isFunction(e))&&Deft.isFunction(d=e.then)){a=false;try{b=this;d.call(e,function(g){if(!a){a=true;b.resolve(g)}},function(g){if(!a){a=true;b.reject(g)}})}catch(f){c=f;if(!a){this.reject(c)}}}else{this.complete("fulfill",e)}}catch(f){c=f;this.reject(c)}},reject:function(a){if(this.completed){return}this.complete("reject",a)},update:function(b){var c,e,a,d;if(this.completed){return}d=this.consequences;for(e=0,a=d.length;e<a;e++){c=d[e];c.update(b)}},complete:function(f,e){var b,d,a,c;this.completionAction=f;this.completionValue=e;this.completed=true;c=this.consequences;for(d=0,a=c.length;d<a;d++){b=c[d];b.trigger(this.completionAction,this.completionValue)}this.consequences=null}});Ext.define("Deft.promise.Deferred",{alternateClassName:["Deft.Deferred"],requires:["Deft.promise.Resolver"],statics:{resolve:function(b){var a;a=Ext.create("Deft.promise.Deferred");a.resolve(b);return a.promise},reject:function(b){var a;a=Ext.create("Deft.promise.Deferred");a.reject(b);return a.promise}},promise:null,resolver:null,constructor:function(){this.resolver=Ext.create("Deft.promise.Resolver");this.promise=this.resolver.promise;return this},resolve:function(a){this.resolver.resolve(a)},reject:function(a){this.resolver.reject(a)},update:function(a){this.resolver.update(a)},getPromise:function(){return this.promise}});Ext.define("Deft.promise.Promise",{alternateClassName:["Deft.Promise"],requires:["Deft.promise.Deferred","Deft.util.Function"],statics:{when:function(a){var b;b=Ext.create("Deft.promise.Deferred");b.resolve(a);return b.promise},isPromise:function(a){return(Ext.isObject(a)||Deft.isFunction(a))&&Deft.isFunction(a.then)},all:function(a){if(!(Ext.isArray(a)||Deft.Promise.isPromise(a))){throw new Error("Invalid parameter: expected an Array or Promise of an Array.")}return Deft.Promise.when(a).then(function(c){var j,g,b,f,i,e,d,h;f=c.length;e=new Array(c.length);j=Ext.create("Deft.promise.Deferred");if(!f){j.resolve(e)}else{i=function(l,k){return Deft.Promise.when(l).then(function(m){e[k]=m;if(!--f){j.resolve(e)}return m},function(m){return j.reject(m)})};for(g=d=0,h=c.length;d<h;g=++d){b=c[g];if(g in c){i(b,g)}else{f--}}}return j.promise})},any:function(a){if(!(Ext.isArray(a)||Deft.Promise.isPromise(a))){throw new Error("Invalid parameter: expected an Array or Promise of an Array.")}return Deft.Promise.some(a,1).then(function(b){return b[0]},function(b){if(b instanceof Error&&b.message==="Too few Promises were resolved."){throw new Error("No Promises were resolved.")}else{throw b}})},some:function(b,a){if(!(Ext.isArray(b)||Deft.Promise.isPromise(b))){throw new Error("Invalid parameter: expected an Array or Promise of an Array.")}if(!Ext.isNumeric(a)||a<=0){throw new Error("Invalid parameter: expected a positive integer.")}return Deft.Promise.when(b).then(function(f){var m,h,k,l,d,c,g,j,e,i;j=[];g=a;c=(f.length-g)+1;m=Ext.create("Deft.promise.Deferred");if(f.length<a){m.reject(new Error("Too few Promises were resolved."))}else{l=function(n){if(g>0){j.push(n)}g--;if(g===0){m.resolve(j)}return n};k=function(n){c--;if(c===0){m.reject(new Error("Too few Promises were resolved."))}return n};for(h=e=0,i=f.length;e<i;h=++e){d=f[h];if(h in f){Deft.Promise.when(d).then(l,k)}}}return m.promise})},delay:function(a,c){var b;if(arguments.length===1){c=a;a=void 0}c=Math.max(c,0);b=Ext.create("Deft.promise.Deferred");setTimeout(function(){b.resolve(a)},c);return b.promise},timeout:function(b,d){var a,c,e;c=Ext.create("Deft.promise.Deferred");e=setTimeout(function(){if(e){c.reject(new Error("Promise timed out."))}},d);a=function(){clearTimeout(e);return e=null};Deft.Promise.when(b).then(function(f){a();c.resolve(f)},function(f){a();c.reject(f)});return c.promise},memoize:function(d,c,a){var b;b=Deft.util.Function.memoize(d,c,a);return function(){return Deft.Promise.all(Ext.Array.toArray(arguments)).then(function(e){return b.apply(c,e)})}},map:function(a,b){if(!(Ext.isArray(a)||Deft.Promise.isPromise(a))){throw new Error("Invalid parameter: expected an Array or Promise of an Array.")}if(!Deft.isFunction(b)){throw new Error("Invalid parameter: expected a function.")}return Deft.Promise.when(a).then(function(d){var k,h,c,g,j,f,e,i;g=d.length;f=new Array(d.length);k=Ext.create("Deft.promise.Deferred");if(!g){k.resolve(f)}else{j=function(m,l){return Deft.Promise.when(m).then(function(n){return b(n,l,f)}).then(function(n){f[l]=n;if(!--g){k.resolve(f)}return n},function(n){return k.reject(n)})};for(h=e=0,i=d.length;e<i;h=++e){c=d[h];if(h in d){j(c,h)}else{g--}}}return k.promise})},reduce:function(b,c,a){var d;if(!(Ext.isArray(b)||Deft.Promise.isPromise(b))){throw new Error("Invalid parameter: expected an Array or Promise of an Array.")}if(!Deft.isFunction(c)){throw new Error("Invalid parameter: expected a function.")}d=arguments.length===3;return Deft.Promise.when(b).then(function(f){var e;e=[function(h,i,g){return Deft.Promise.when(h).then(function(j){return Deft.Promise.when(i).then(function(k){return c(j,k,g,f)})})}];if(d){e.push(a)}return Deft.Promise.reduceArray.apply(f,e)})},reduceArray:function(f,a){var d,g,c,e,b;c=0;g=Object(this);e=g.length>>>0;d=arguments;if(d.length<=1){while(true){if(c in g){b=g[c++];break}if(++c>=e){throw new TypeError("Reduce of empty array with no initial value")}}}else{b=d[1]}while(c<e){if(c in g){b=f(b,g[c],c,g)}c++}return b},rethrowError:function(a){Deft.util.Function.nextTick(function(){throw a})}},resolver:null,constructor:function(a){this.resolver=a;return this},then:function(e,a,d,b){var c;if(arguments.length===1&&Ext.isObject(arguments[0])){c=arguments[0],e=c.success,a=c.failure,d=c.progress,b=c.scope}if(b!=null){if(Deft.isFunction(e)){e=Ext.Function.bind(e,b)}if(Deft.isFunction(a)){a=Ext.Function.bind(a,b)}if(Deft.isFunction(d)){d=Ext.Function.bind(d,b)}}return this.resolver.then(e,a,d)},otherwise:function(a,b){var c;if(arguments.length===1&&Ext.isObject(arguments[0])){c=arguments[0],a=c.fn,b=c.scope}if(b!=null){a=Ext.Function.bind(a,b)}return this.resolver.then(null,a)},always:function(a,b){var c;if(arguments.length===1&&Ext.isObject(arguments[0])){c=arguments[0],a=c.fn,b=c.scope}if(b!=null){a=Ext.Function.bind(a,b)}return this.resolver.then(function(e){var d;try{a()}catch(f){d=f;Deft.promise.Promise.rethrowError(d)}return e},function(e){var d;try{a()}catch(f){d=f;Deft.promise.Promise.rethrowError(d)}throw e})},done:function(){this.resolver.then(null,Deft.promise.Promise.rethrowError)},cancel:function(a){if(a==null){a=null}this.resolver.reject(new CancellationError(a))},log:function(a){if(a==null){a=""}return this.resolver.then(function(b){Deft.Logger.log(""+(a||"Promise")+" resolved with value: "+b);return b},function(b){Deft.Logger.log(""+(a||"Promise")+" rejected with reason: "+b);throw b})}},function(){var a;if(Array.prototype.reduce!=null){this.reduceArray=Array.prototype.reduce}a=typeof exports!=="undefined"&&exports!==null?exports:window;a.CancellationError=function(b){if(Error.captureStackTrace){Error.captureStackTrace(this,CancellationError)}this.name="Canceled";this.message=b};a.CancellationError.prototype=new Error();a.CancellationError.constructor=a.CancellationError});Ext.define("Deft.promise.Chain",{alternateClassName:["Deft.Chain"],requires:["Deft.promise.Promise","Deft.util.Function"],statics:{sequence:function(b,c){var a;if(c==null){c=null}a=[].slice.call(arguments,2);return Deft.Promise.reduce(b,function(d,e){if(!Deft.isFunction(e)){throw new Error("Invalid parameter: expected a function.")}return Deft.Promise.when(e.apply(c,a)).then(function(f){d.push(f);return d})},[])},parallel:function(b,c){var a;if(c==null){c=null}a=[].slice.call(arguments,2);return Deft.Promise.map(b,function(d){if(!Ext.isFunction(d)){throw new Error("Invalid parameter: expected a function.")}return d.apply(c,a)})},pipeline:function(b,a,c){if(c==null){c=null}return Deft.Promise.reduce(b,function(e,d){if(!Ext.isFunction(d)){throw new Error("Invalid parameter: expected a function.")}return d.call(c,e)},a)}}});